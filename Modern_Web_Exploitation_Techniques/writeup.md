# Modern Web Exploitation Techniques
https://academy.hackthebox.com/module/231/section/2476

# Introduction to DNS Rebinding

```bash

dig A academy.hackthebox.com

```

# SSRF Basic Filter Bypasses

## Obfuscation of localhost
## Bypass via DNS Resolution

```
nslookup localtest.me

```

## Bypass via HTTP Redirect

In addition to resolving the domain name, the improved filter returns False by default and only returns True if no exception was raised. However, the filter does not account for HTTP redirects which the headless Chrome browser will follow. Thus, we can bypass the filter by providing a URL pointing to a web server under our control, redirecting the web application to the local debug endpoint. To do so, we can host the following PHP code on our web server:
Code: php
```php
<?php header('Location: http://127.0.0.1/debug'); ?>
```
We can host the file using the built-in PHP web server:
SSRF Basic Filter Bypasses
```bash
Avataris1210@htb[/htb]$ php -S 0.0.0.0:80

[Sun Aug 13 10:55:35 2023] PHP 7.4.33 Development Server (http://0.0.0.0:80) started
```
We can then bypass the filter by providing a URL pointing to the PHP code hosted on our web server:


# Question 

```
http://0.0.0.0/flag

```

# DNS Rebinding: SSRF Filter Bypass

methodology:

    We need to provide the web application with a domain under our control so that we can change its DNS configuration; for this section, suppose we own the domain attacker.htb and can change its DNS configuration. We will configure the DNS server to resolve attacker.htb to any IP address that is not blacklisted, such as 1.1.1.1, and assign it a very low TTL.
    When we provide the web application with the URL http://attacker.htb/flag, it will resolve the domain name to 1.1.1.1 and verifies that it is not an internal IP address; since the function assigned to global_check evaluates to True, global_check becomes True. The if statement has both conditions evaluating to True, therefore allowing us access to the render_template function.
    Subsequently, we will rebind the DNS configuration for attacker.htb to resolve to 127.0.0.1 instead of 1.1.1.1. When attempting to get the flag in the flag function, and because of the low TTL assigned to attacker.htb, the web application will resolve attacker.htb again.
    At last, due to the DNS rebinding, the second DNS resolution will resolve the domain name attacker.htb to 127.0.0.1 such that the web application accesses the URL http://127.0.0.1/flag and fetches the flag for us.

Exploitation

To bypass the SSRF filter via DNS rebinding in the actual web application, we can use rbndr.us, a service that generates a domain name that randomly resolves to the two IP addresses specified:

```bash
sudo python3 dnsrebinder.py --domain attacker.com --rebind 127.0.0.1 --ip 1.1.1.1 --counter 1 --tcp --udp

```

# DNS Rebinding: Same-Origin Policy Bypass
